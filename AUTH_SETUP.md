# Настройка аутентификации и ролей

## Шаг 1: Выполните SQL скрипт в Supabase

1. Откройте Supabase Dashboard: https://supabase.com/dashboard/project/oojntidzikkhaivfdnee/sql
2. Откройте файл `database_auth.sql` и скопируйте весь его содержимое
3. Вставьте в SQL Editor в Supabase
4. Нажмите **Run** (или Ctrl+Enter)

Этот скрипт:
- Создаст таблицу `user_profiles` для хранения ролей пользователей
- Добавит поле `user_id` в таблицу `documents`
- Настроит RLS политики для разграничения доступа

## Шаг 2: Включите Email аутентификацию в Supabase

1. Перейдите в **Authentication** → **Providers** в Supabase Dashboard
2. Убедитесь, что **Email** provider включен
3. Настройте Email templates (опционально)

## Шаг 3: Настройте Email подтверждение (опционально)

По умолчанию Supabase требует подтверждение email. Для разработки можно отключить:

1. Перейдите в **Authentication** → **Settings**
2. Отключите **Enable email confirmations** (для тестирования)
3. Или настройте SMTP для отправки писем

## Роли пользователей

- **admin** - полный доступ (создание, редактирование, удаление документов)
- **partner** - только просмотр документов

## Регистрация первого администратора

1. Запустите приложение: `npm run dev`
2. Зарегистрируйтесь с ролью "Администратор"
3. Или создайте пользователя напрямую в Supabase и назначьте роль через SQL:

```sql
-- После регистрации пользователя, обновите его роль на admin
UPDATE user_profiles 
SET role = 'admin' 
WHERE email = 'ваш-email@example.com';
```

## Проверка работы

1. Зарегистрируйте пользователя с ролью "Партнер"
2. Войдите - должна быть видна только кнопка "Просмотреть"
3. Зарегистрируйте пользователя с ролью "Администратор"
4. Войдите - должны быть доступны все функции (создание, редактирование, удаление)

## Важные замечания

- В продакшене рекомендуется включить подтверждение email
- Настройте SMTP для отправки писем с подтверждением
- Рассмотрите возможность добавления двухфакторной аутентификации
- Регулярно проверяйте RLS политики на безопасность
