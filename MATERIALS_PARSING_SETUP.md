# Настройка парсинга материалов с dreviz-shop.ru

## Что было создано

### 1. Структура базы данных ✅
Таблица `materials` создана через скрипт `database_materials.sql`

### 2. Функции парсинга ✅
Файл `src/lib/parsing.ts` содержит функции для:
- Парсинга данных материалов из API
- Извлечения тиснения, толщины, размеров, бренда из названия
- Преобразования данных в нужный формат

### 3. Хук для работы с материалами ✅
Файл `src/hooks/useMaterials.ts` предоставляет:
- Загрузку материалов из базы данных
- Сохранение и обновление материалов
- Массовую синхронизацию
- Поиск материалов по артикулу и тиснению

## Что нужно сделать дальше

### Вариант 1: Парсинг через API (Рекомендуется)

Сайт dreviz-shop.ru использует API endpoint:
```
GET https://dreviz-shop.ru/api/search?criteria[section]=524&criteria[group]=54e8acc9-d20c-11e6-80d9-00155d006309&criteria[features][25411cc9-33c7-11e6-80d5-00155d006309][]=25411cd1-33c7-11e6-80d5-00155d006309&page=1
```

**Проблема:** API может требовать авторизацию или специальные заголовки.

**Решение:**
1. Создать Supabase Edge Function для парсинга (серверная логика)
2. Или использовать Vercel Serverless Functions
3. Или парсить напрямую из клиента (если API доступен без авторизации)

### Вариант 2: Парсинг HTML (Если API недоступен)

Использовать headless browser (puppeteer/playwright) для:
- Открытия страниц сайта
- Извлечения данных из HTML таблицы
- Обработки пагинации (713 товаров на 36 страниц)

## Рекомендуемый подход

1. **Создать Supabase Edge Function** для парсинга:
   - Функция будет запускаться на сервере
   - Нет проблем с CORS
   - Можно настроить cron job для автоматического запуска

2. **Или создать API route в Vercel** (если не используем Supabase Functions)

3. **Для автоматического обновления:**
   - Supabase Cron Jobs (если используем Edge Functions)
   - Vercel Cron Jobs (если используем Vercel Functions)

## Следующие шаги

1. Выбрать подход (Edge Function или Vercel Function)
2. Реализовать функцию парсинга
3. Протестировать на реальных данных
4. Настроить автоматическое ежедневное обновление

## Важные вопросы

1. **Доступен ли API без авторизации?** - нужно проверить
2. **Как часто нужно обновлять данные?** - вы указали "каждый день"
3. **Какие материалы парсить?** - все 713 или только определенные категории?
